(function() {
  'use strict';
  angular.module('somsri.somsri.expenses_tag', [
    ])
  .controller('expensesTagCtrl', ['$rootScope','expensesTagService','$scope', 'translateFilter', function($rootScope, service, $scope, translateFilter) {
    $rootScope.menu = translateFilter('setting')
    var ctrl = this
    $rootScope.loadAndAuthorizeResource("setting", function(){
      service.getExpenseTags().then(function(resp) {
        ctrl.datas = resp.data;
      });

      $rootScope.loadAndAuthorizeResource("school", function(){
        ctrl.canUpdateSchool = true;
      },function(){});

      ctrl.save = function(){
        if (validateData()){
          var confirmationMessage = translateFilter('save_change_confirmation')
          $rootScope.openConfirmationModal(confirmationMessage,
            function(){
              service.saveExpenseTags(ctrl.datas).then(function(resp) {
                ctrl.datas = resp.data;
                ctrl.message = translateFilter('save_expense_tag_success');
                ctrl.typeSuccess = true;
              });
            }
          )
        }
      }

      ctrl.addNewTag = function(){
        ctrl.datas.push({ name: null, description: null })
      }

      ctrl.removeTag = function(index){
        ctrl.datas.splice(index, 1);
      }

      function validateData(){
        for(var i = 0; i < ctrl.datas.length; i++){
          if(ctrl.datas[i]['description'] && !ctrl.datas[i]['name']){
            ctrl.message = translateFilter('expenses_tag_required_name');
            ctrl.typeSuccess = false;
            return false;
          }
        }
        return true;
      }
    });
  }]);
})();
