(function() {
    'use strict';
    angular.module('somsri.itpc.personal_setting', [])
        .controller('personalCtrl', ['$rootScope', 'settingService', '$scope', '$uibModal', function($rootScope, service, $scope, $uibModal) {
            $rootScope.menu = "ข้อมูลส่วนตัว"
            var ctrl = this
            service.getSetting().then(function(resp) {
                ctrl.datas = resp.data;
                ctrl.datas.password = "password";
            });

            ctrl.submit = function(params) {
                service.saveSetting(params).then(function(resp) {
                    $scope.message = 'บันทึกข้อมูลสำเร็จ';
                    $uibModal.open({
                        animation: true,
                        backdrop: 'static',
                        keyboard: false,
                        scope: $scope,
                        templateUrl: "<%= asset_path('somsri/angular/components/modal/success/successModalView.html') %>",
                        controller: 'successModalCtrl as success',
                        size: 'md',
                        resolve: {
                            resources: ['$ocLazyLoad', 'ASSETS', function($ocLazyLoad, ASSETS) {
                                return $ocLazyLoad.load([
                                    ASSETS.somsri.main.success_modal
                                ]);
                            }]
                        }
                    });
                });
            }


            ctrl.changePassword = function() {
                $uibModal.open({
                    animation: true,
                    backdrop: 'static',
                    keyboard: false,
                    scope: $scope,
                    templateUrl: "<%= asset_path('main/angular/components/modal/password/passwordModalView.html') %>",
                    controller: 'passwordModalCtrl as password',
                    size: 'md',
                    resolve: {
                        resources: ['$ocLazyLoad', 'ASSETS', function($ocLazyLoad, ASSETS) {
                            return $ocLazyLoad.load([
                                ASSETS.somsri.main.password_modal
                            ]);
                        }]
                    }
                }).result.then(function(isSuccess) {
                    if (isSuccess) {
                        $rootScope.openRoot();
                    }
                });
            }

        }]);
})();