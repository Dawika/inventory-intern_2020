(function() {
'use strict';
angular.module('somsri.main.manage_classroom', [])
    .controller('manageClassroomCtrl', ['$rootScope', '$scope', 'translateFilter', 'classroomService', function($rootScope, $scope, translateFilter, service) {
        $rootScope.menu = translateFilter('setting')
        var ctrl = this;
        ctrl.list = new Array
        ctrl.input_create = true
        ctrl.button_create = false
        ctrl.class_info_sorting = [];

        service.getGrades().then(function(resp) {
            for(var i=0 ; i < resp.data.length ; i++){
                resp.data[i].id != -1 ? ctrl.list.push(resp.data[i]) : false
            }
        })

        ctrl.show_create = function(show){
          ctrl.input_create = show
          ctrl.button_create = !show
          show == 'create' ? true : ctrl.grade_name = ""
        }

        ctrl.create = function(grade){
          service.create_grade(grade).then(function(resp){
            ctrl.list = resp.data
            ctrl.openmodal(resp, I18n.t('save_success'))
          })
        }

        ctrl.update = function(data){
         $rootScope.openConfirmationModal(I18n.t('confirm_update_grade') , false, function(){
            service.update_grade(data).then(function(resp){
              ctrl.openmodal(resp, I18n.t('update_data_success'))
            })
          })
        }

        ctrl.delete = function(id){
          $rootScope.openConfirmationModal(I18n.t('confirm_delete_grade'), true , function(){
            service.delete_grade(id).then(function(resp){
              ctrl.list = resp.data
              ctrl.openmodal(resp, I18n.t('delete_success'))
            })
          })
        }

        ctrl.sortableOptions = {
          stop: function() { 
            for(var index = 0; index < ctrl.list.length; index++){
              ctrl.class_info_sorting.push(ctrl.list[index])
            }
            service.sorting(ctrl.class_info_sorting)
          }
        }

        ctrl.openmodal = function(resp, message){
          !resp.data.error ? $rootScope.opensuccessModal(message) : $rootScope.opensuccessModal(I18n.t('vacation_save_error'));
        }


    }]);
})();