(function() {
  'use strict';
  angular.module('somsri.rollcall.expenses.service', [
  ])
  .service('expensesService', ['$http', '$q', 'Upload', function($http, $q, Upload) {

    var getExpensesCanceler = $q.defer()
    this.getExpenses = function(searchKeyword, start_date, end_date, page, sort, order) {
      getExpensesCanceler.resolve()
      getExpensesCanceler = $q.defer()
      return $http.get('/expenses', {
        timeout: getExpensesCanceler.promise,
        params: {
          page: page,
          search_keyword: searchKeyword,
          start_date: start_date,
          end_date: end_date,
          sort: sort,
          order: order
        }
      })
    }

    this.removeExpenses = function(id) {
      return $http.delete('/expenses/' + id.id)
    }

    this.show = function(item) {
      return $http.get('/expenses/' + item.id)
    }

    this.editExpenses = function(data) {
      return  Upload.upload({
          url: '/expenses/' + data.item_id,
          method: 'put',
          data: { expense: data }
        });
    }

    this.createExpenses = function(data) {
      return Upload.upload({
          url: '/expenses',
          method: 'post',
          data: { expense: data }
        });
    }
    
  }]);
})();
